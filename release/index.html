<!doctype html>
<html lang="en">
    <head>
        <title>Air search test</title>
        <script src="client.js"></script>
    </head>
    <body>
        <input
            type="text"
            id="searchInput"
            placeholder="Search Latvian company"
        />

        <div id="results"></div>
        <script>
            document.addEventListener("DOMContentLoaded", function () {
                // GET ELEMENTS
                const searchInput = document.getElementById("searchInput");
                // START SOCKET
                let socket = air.start();
                // LISTEN TO document.airMessage FOR SUCCESFUL SEARCH RESULTS
                document.addEventListener("airMessage", function (event) {
                    // JUST FOR THIS FRONTEND HERE - MAKE SURE THERE'S OVER 0 LINES
                    if (
                        event.detail &&
                        event.detail.result &&
                        event.detail.result.length &&
                        event.detail.result.length > 0
                    ) {
                        // FIND PLACE TO PRINT
                        const resultsDiv = document.getElementById("results");
                        // RESTART "CANVAS"
                        resultsDiv.innerHTML = "";
                        // WRITE
                        for (let i = 0; i < event.detail.result.length; i++) {
                            resultsDiv.innerHTML += `<p>${JSON.stringify(event.detail.result[i])}</p>`;
                        }
                    }
                });
                // "HANDLE" ERRORS
                document.addEventListener("airError", function (event) {
                    console.error("Air error received:", event.detail);
                });
                // WAIT FOR SOCKET TO OPEN
                socket.addEventListener("open", function (event) {
                    // WAIT FOR KEYPRESS
                    searchInput.addEventListener("input", function () {
                        // TRIM INPUT
                        const searchTerm = searchInput.value.trim();
                        // PERFORM SEARCH
                        air.search(searchTerm, function (err, result) {
                            if (err) {
                                // RESTART ON ERROR
                                socket = air.start();
                            }
                        });
                    });
                });
            });
        </script>
    </body>
</html>
